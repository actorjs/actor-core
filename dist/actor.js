(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.actorjs = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = {
    ActorRef: require("./src/ActorRef"),
    ActorContext: require("./src/ActorContext"),
    ActorSystem: require("./src/ActorSystem"),
    ActorUtil: require("./src/ActorUtil")
}

},{"./src/ActorContext":2,"./src/ActorRef":3,"./src/ActorSystem":4,"./src/ActorUtil":5}],2:[function(require,module,exports){
var ActorSystem = require("./ActorSystem");


var ActorContext = function (actor, reference, system, parent) {
    actor.context = this;
    actor.self = reference;
    reference.context = this;
    this.system = system;
    this.self = reference;
    this.parent = parent;
    this.children = { };

}

ActorContext.prototype.actorOf = function(clss, name, options) {
    var ActorUtil = require("./ActorUtil");
    var child = ActorUtil.newActor(clss, this.system, this.self, name, options);
    this.children[name] = child;
    return child;
}

ActorContext.prototype.actorFor = function(name) {
    if (name[0] === '/')
        return this.system.actorFor(name);

    if (name === '..')
        return this.parent;

    if (name.substring(0, 3) === '../')
        return this.parent.context.actorFor(name.substring(3));

    if (name.indexOf(':') > 0)
        return this.system.actorFor(name);

    var position = name.indexOf('/');

    if (position > 0) {
        var rest = name.substring(position + 1);
        name = name.substring(0, position);
        return this.children[name].context.actorFor(rest);
    }
    else
        return this.children[name];
}

module.exports = ActorContext;
},{"./ActorSystem":4,"./ActorUtil":5}],3:[function(require,module,exports){
function ActorRef(actor, parentpath, name) {
    this.actor = actor;
    this.path = parentpath + "/" + name;
}

ActorRef.prototype.tell = function (msg) {
    this.actor.receive(msg);
}

module.exports = ActorRef;
},{}],4:[function(require,module,exports){
var ActorUtil = require("./ActorUtil");

function ActorSystem(name) {
    var counter = 0;
    this.name = name;
    this.path = "actor://" + name;
    this.children = { };

    this.nextName = function () {
        counter++;
        return '_' + counter;
    }
}

ActorSystem.prototype.actorOf = function(clss, name, options) {
    console.log("ActorUtil: ",ActorUtil)
    var actor = ActorUtil.newActor(clss, this, null, name, options);
    this.children[name] = actor;
    return actor;
}

ActorSystem.prototype.actorFor = function (name) {
    if (name.indexOf(':') > 0) {
        var path = ActorUtil.parsePath(name);

        if (path.server) {
            var servername = path.server + ':' + path.port;
            if (servername !== this.node.name)
                return this.node.getNode(servername).getSystem(path.system).actorFor(path.path);
        }

        name = path.path;
    }

    if (name && name[0] === '/')
        name = name.substring(1);

    var position = name.indexOf('/');

    if (position > 0) {
        var rest = name.substring(position + 1);
        name = name.substring(0, position);
        return this.children[name].context.actorFor(rest);
    }
    else
        return this.children[name];
}

module.exports = ActorSystem;

},{"./ActorUtil":5}],5:[function(require,module,exports){
var ActorUtil = {
    newActor: function (clss, system, parent, name, options) {
        var actor;

        if (typeof clss === 'function')
            actor = new clss();
        else
            actor = clss;

        if (!name)
            name = system.nextName();

        console.log("name: ", name)

        var ActorRef = require("./ActorRef");
        var ref = new ActorRef(actor, parent ? parent.path : system.path, name);

        if (options && options.router)
            ref = new ActorRouterRef(ref);

        var ActorContext = require("./ActorContext");
        var context = new ActorContext(actor, ref, system, parent);

        return ref;
    },
    parsePath: function (path) {
        var result = {};
        var position = path.indexOf(':');

        result.protocol = path.substring(0, position);

        var rest = path.substring(position + 3);

        var positionat = rest.indexOf('@');
        position = rest.indexOf('/');

        if (positionat >= 0 && positionat < position) {
            result.system = rest.substring(0, positionat);
            result.server = rest.substring(positionat + 1, position);

            var poscolon = result.server.indexOf(':');

            if (poscolon > 0) {
                result.port = parseInt(result.server.substring(poscolon + 1));
                result.server = result.server.substring(0, poscolon);
            }
        }
        else
            result.system = rest.substring(0, position);

        result.path = rest.substring(position);

        return result;
    }
}

module.exports = ActorUtil;

},{"./ActorContext":2,"./ActorRef":3}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJEOlxcUHJvamVjdHNcXGFjdG9yanNcXGFjdG9yLWNvcmVcXGluZGV4LmpzIiwiRDpcXFByb2plY3RzXFxhY3RvcmpzXFxhY3Rvci1jb3JlXFxzcmNcXEFjdG9yQ29udGV4dC5qcyIsIkQ6XFxQcm9qZWN0c1xcYWN0b3Jqc1xcYWN0b3ItY29yZVxcc3JjXFxBY3RvclJlZi5qcyIsIkQ6XFxQcm9qZWN0c1xcYWN0b3Jqc1xcYWN0b3ItY29yZVxcc3JjXFxBY3RvclN5c3RlbS5qcyIsIkQ6XFxQcm9qZWN0c1xcYWN0b3Jqc1xcYWN0b3ItY29yZVxcc3JjXFxBY3RvclV0aWwuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQSxNQUFNLENBQUMsT0FBTyxHQUFHO0lBQ2IsUUFBUSxFQUFFLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztJQUNuQyxZQUFZLEVBQUUsT0FBTyxDQUFDLG9CQUFvQixDQUFDO0lBQzNDLFdBQVcsRUFBRSxPQUFPLENBQUMsbUJBQW1CLENBQUM7SUFDekMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQzs7OztBQ0p6QyxJQUFJLFdBQVcsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDM0M7O0FBRUEsSUFBSSxZQUFZLEdBQUcsVUFBVSxLQUFLLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUU7SUFDM0QsS0FBSyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7SUFDckIsS0FBSyxDQUFDLElBQUksR0FBRyxTQUFTLENBQUM7SUFDdkIsU0FBUyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7SUFDekIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDckIsSUFBSSxDQUFDLElBQUksR0FBRyxTQUFTLENBQUM7SUFDdEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7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SSxDQUFDLFNBQVMsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDOztBQUVyRSxZQUFZLElBQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDOztZQUUxQyxJQUFJLFFBQVEsR0FBRyxDQUFDLEVBQUU7Z0JBQ2QsTUFBTSxDQUFDLElBQUksR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlELE1BQU0sQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO2FBQ3hEO0FBQ2IsU0FBUzs7QUFFVCxZQUFZLE1BQU0sQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7O0FBRXhELFFBQVEsTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDOztRQUV2QyxPQUFPLE1BQU0sQ0FBQztLQUNqQjtBQUNMLENBQUM7O0FBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRyxTQUFTIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIm1vZHVsZS5leHBvcnRzID0ge1xyXG4gICAgQWN0b3JSZWY6IHJlcXVpcmUoXCIuL3NyYy9BY3RvclJlZlwiKSxcclxuICAgIEFjdG9yQ29udGV4dDogcmVxdWlyZShcIi4vc3JjL0FjdG9yQ29udGV4dFwiKSxcclxuICAgIEFjdG9yU3lzdGVtOiByZXF1aXJlKFwiLi9zcmMvQWN0b3JTeXN0ZW1cIiksXHJcbiAgICBBY3RvclV0aWw6IHJlcXVpcmUoXCIuL3NyYy9BY3RvclV0aWxcIilcclxufSIsInZhciBBY3RvclN5c3RlbSA9IHJlcXVpcmUoXCIuL0FjdG9yU3lzdGVtXCIpO1xyXG5cclxuXHJcbnZhciBBY3RvckNvbnRleHQgPSBmdW5jdGlvbiAoYWN0b3IsIHJlZmVyZW5jZSwgc3lzdGVtLCBwYXJlbnQpIHtcclxuICAgIGFjdG9yLmNvbnRleHQgPSB0aGlzO1xyXG4gICAgYWN0b3Iuc2VsZiA9IHJlZmVyZW5jZTtcclxuICAgIHJlZmVyZW5jZS5jb250ZXh0ID0gdGhpcztcclxuICAgIHRoaXMuc3lzdGVtID0gc3lzdGVtO1xyXG4gICAgdGhpcy5zZWxmID0gcmVmZXJlbmNlO1xyXG4gICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XHJcbiAgICB0aGlzLmNoaWxkcmVuID0geyB9O1xyXG5cclxufVxyXG5cclxuQWN0b3JDb250ZXh0LnByb3RvdHlwZS5hY3Rvck9mID0gZnVuY3Rpb24oY2xzcywgbmFtZSwgb3B0aW9ucykge1xyXG4gICAgdmFyIEFjdG9yVXRpbCA9IHJlcXVpcmUoXCIuL0FjdG9yVXRpbFwiKTtcclxuICAgIHZhciBjaGlsZCA9IEFjdG9yVXRpbC5uZXdBY3RvcihjbHNzLCB0aGlzLnN5c3RlbSwgdGhpcy5zZWxmLCBuYW1lLCBvcHRpb25zKTtcclxuICAgIHRoaXMuY2hpbGRyZW5bbmFtZV0gPSBjaGlsZDtcclxuICAgIHJldHVybiBjaGlsZDtcclxufVxyXG5cclxuQWN0b3JDb250ZXh0LnByb3RvdHlwZS5hY3RvckZvciA9IGZ1bmN0aW9uKG5hbWUpIHtcclxuICAgIGlmIChuYW1lWzBdID09PSAnLycpXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3lzdGVtLmFjdG9yRm9yKG5hbWUpO1xyXG5cclxuICAgIGlmIChuYW1lID09PSAnLi4nKVxyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudDtcclxuXHJcbiAgICBpZiAobmFtZS5zdWJzdHJpbmcoMCwgMykgPT09ICcuLi8nKVxyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudC5jb250ZXh0LmFjdG9yRm9yKG5hbWUuc3Vic3RyaW5nKDMpKTtcclxuXHJcbiAgICBpZiAobmFtZS5pbmRleE9mKCc6JykgPiAwKVxyXG4gICAgICAgIHJldHVybiB0aGlzLnN5c3RlbS5hY3RvckZvcihuYW1lKTtcclxuXHJcbiAgICB2YXIgcG9zaXRpb24gPSBuYW1lLmluZGV4T2YoJy8nKTtcclxuXHJcbiAgICBpZiAocG9zaXRpb24gPiAwKSB7XHJcbiAgICAgICAgdmFyIHJlc3QgPSBuYW1lLnN1YnN0cmluZyhwb3NpdGlvbiArIDEpO1xyXG4gICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygwLCBwb3NpdGlvbik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW5bbmFtZV0uY29udGV4dC5hY3RvckZvcihyZXN0KTtcclxuICAgIH1cclxuICAgIGVsc2VcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbltuYW1lXTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBBY3RvckNvbnRleHQ7XHJcbiIsImZ1bmN0aW9uIEFjdG9yUmVmKGFjdG9yLCBwYXJlbnRwYXRoLCBuYW1lKSB7XHJcbiAgICB0aGlzLmFjdG9yID0gYWN0b3I7XHJcbiAgICB0aGlzLnBhdGggPSBwYXJlbnRwYXRoICsgXCIvXCIgKyBuYW1lO1xyXG59XHJcblxyXG5BY3RvclJlZi5wcm90b3R5cGUudGVsbCA9IGZ1bmN0aW9uIChtc2cpIHtcclxuICAgIHRoaXMuYWN0b3IucmVjZWl2ZShtc2cpO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEFjdG9yUmVmO1xyXG4iLCJ2YXIgQWN0b3JVdGlsID0gcmVxdWlyZShcIi4vQWN0b3JVdGlsXCIpO1xyXG5cclxuZnVuY3Rpb24gQWN0b3JTeXN0ZW0obmFtZSkge1xyXG4gICAgdmFyIGNvdW50ZXIgPSAwO1xyXG4gICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgIHRoaXMucGF0aCA9IFwiYWN0b3I6Ly9cIiArIG5hbWU7XHJcbiAgICB0aGlzLmNoaWxkcmVuID0geyB9O1xyXG5cclxuICAgIHRoaXMubmV4dE5hbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY291bnRlcisrO1xyXG4gICAgICAgIHJldHVybiAnXycgKyBjb3VudGVyO1xyXG4gICAgfVxyXG59XHJcblxyXG5BY3RvclN5c3RlbS5wcm90b3R5cGUuYWN0b3JPZiA9IGZ1bmN0aW9uKGNsc3MsIG5hbWUsIG9wdGlvbnMpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiQWN0b3JVdGlsOiBcIixBY3RvclV0aWwpXHJcbiAgICB2YXIgYWN0b3IgPSBBY3RvclV0aWwubmV3QWN0b3IoY2xzcywgdGhpcywgbnVsbCwgbmFtZSwgb3B0aW9ucyk7XHJcbiAgICB0aGlzLmNoaWxkcmVuW25hbWVdID0gYWN0b3I7XHJcbiAgICByZXR1cm4gYWN0b3I7XHJcbn1cclxuXHJcbkFjdG9yU3lzdGVtLnByb3RvdHlwZS5hY3RvckZvciA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICBpZiAobmFtZS5pbmRleE9mKCc6JykgPiAwKSB7XHJcbiAgICAgICAgdmFyIHBhdGggPSBBY3RvclV0aWwucGFyc2VQYXRoKG5hbWUpO1xyXG5cclxuICAgICAgICBpZiAocGF0aC5zZXJ2ZXIpIHtcclxuICAgICAgICAgICAgdmFyIHNlcnZlcm5hbWUgPSBwYXRoLnNlcnZlciArICc6JyArIHBhdGgucG9ydDtcclxuICAgICAgICAgICAgaWYgKHNlcnZlcm5hbWUgIT09IHRoaXMubm9kZS5uYW1lKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubm9kZS5nZXROb2RlKHNlcnZlcm5hbWUpLmdldFN5c3RlbShwYXRoLnN5c3RlbSkuYWN0b3JGb3IocGF0aC5wYXRoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG5hbWUgPSBwYXRoLnBhdGg7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKG5hbWUgJiYgbmFtZVswXSA9PT0gJy8nKVxyXG4gICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygxKTtcclxuXHJcbiAgICB2YXIgcG9zaXRpb24gPSBuYW1lLmluZGV4T2YoJy8nKTtcclxuXHJcbiAgICBpZiAocG9zaXRpb24gPiAwKSB7XHJcbiAgICAgICAgdmFyIHJlc3QgPSBuYW1lLnN1YnN0cmluZyhwb3NpdGlvbiArIDEpO1xyXG4gICAgICAgIG5hbWUgPSBuYW1lLnN1YnN0cmluZygwLCBwb3NpdGlvbik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW5bbmFtZV0uY29udGV4dC5hY3RvckZvcihyZXN0KTtcclxuICAgIH1cclxuICAgIGVsc2VcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbltuYW1lXTtcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBBY3RvclN5c3RlbTsiLCJ2YXIgQWN0b3JVdGlsID0ge1xyXG4gICAgbmV3QWN0b3I6IGZ1bmN0aW9uIChjbHNzLCBzeXN0ZW0sIHBhcmVudCwgbmFtZSwgb3B0aW9ucykge1xyXG4gICAgICAgIHZhciBhY3RvcjtcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBjbHNzID09PSAnZnVuY3Rpb24nKVxyXG4gICAgICAgICAgICBhY3RvciA9IG5ldyBjbHNzKCk7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICBhY3RvciA9IGNsc3M7XHJcblxyXG4gICAgICAgIGlmICghbmFtZSlcclxuICAgICAgICAgICAgbmFtZSA9IHN5c3RlbS5uZXh0TmFtZSgpO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhcIm5hbWU6IFwiLCBuYW1lKVxyXG5cclxuICAgICAgICB2YXIgQWN0b3JSZWYgPSByZXF1aXJlKFwiLi9BY3RvclJlZlwiKTtcclxuICAgICAgICB2YXIgcmVmID0gbmV3IEFjdG9yUmVmKGFjdG9yLCBwYXJlbnQgPyBwYXJlbnQucGF0aCA6IHN5c3RlbS5wYXRoLCBuYW1lKTtcclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5yb3V0ZXIpXHJcbiAgICAgICAgICAgIHJlZiA9IG5ldyBBY3RvclJvdXRlclJlZihyZWYpO1xyXG5cclxuICAgICAgICB2YXIgQWN0b3JDb250ZXh0ID0gcmVxdWlyZShcIi4vQWN0b3JDb250ZXh0XCIpO1xyXG4gICAgICAgIHZhciBjb250ZXh0ID0gbmV3IEFjdG9yQ29udGV4dChhY3RvciwgcmVmLCBzeXN0ZW0sIHBhcmVudCk7XHJcblxyXG4gICAgICAgIHJldHVybiByZWY7XHJcbiAgICB9LFxyXG4gICAgcGFyc2VQYXRoOiBmdW5jdGlvbiAocGF0aCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgICAgICB2YXIgcG9zaXRpb24gPSBwYXRoLmluZGV4T2YoJzonKTtcclxuXHJcbiAgICAgICAgcmVzdWx0LnByb3RvY29sID0gcGF0aC5zdWJzdHJpbmcoMCwgcG9zaXRpb24pO1xyXG5cclxuICAgICAgICB2YXIgcmVzdCA9IHBhdGguc3Vic3RyaW5nKHBvc2l0aW9uICsgMyk7XHJcblxyXG4gICAgICAgIHZhciBwb3NpdGlvbmF0ID0gcmVzdC5pbmRleE9mKCdAJyk7XHJcbiAgICAgICAgcG9zaXRpb24gPSByZXN0LmluZGV4T2YoJy8nKTtcclxuXHJcbiAgICAgICAgaWYgKHBvc2l0aW9uYXQgPj0gMCAmJiBwb3NpdGlvbmF0IDwgcG9zaXRpb24pIHtcclxuICAgICAgICAgICAgcmVzdWx0LnN5c3RlbSA9IHJlc3Quc3Vic3RyaW5nKDAsIHBvc2l0aW9uYXQpO1xyXG4gICAgICAgICAgICByZXN1bHQuc2VydmVyID0gcmVzdC5zdWJzdHJpbmcocG9zaXRpb25hdCArIDEsIHBvc2l0aW9uKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBwb3Njb2xvbiA9IHJlc3VsdC5zZXJ2ZXIuaW5kZXhPZignOicpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHBvc2NvbG9uID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnBvcnQgPSBwYXJzZUludChyZXN1bHQuc2VydmVyLnN1YnN0cmluZyhwb3Njb2xvbiArIDEpKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5zZXJ2ZXIgPSByZXN1bHQuc2VydmVyLnN1YnN0cmluZygwLCBwb3Njb2xvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICByZXN1bHQuc3lzdGVtID0gcmVzdC5zdWJzdHJpbmcoMCwgcG9zaXRpb24pO1xyXG5cclxuICAgICAgICByZXN1bHQucGF0aCA9IHJlc3Quc3Vic3RyaW5nKHBvc2l0aW9uKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBBY3RvclV0aWw7Il19
