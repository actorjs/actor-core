(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.actorjs = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = {
    ActorRef: require("./src/ActorRef"),
    ActorContext: require("./src/ActorContext"),
    ActorSystem: require("./src/ActorSystem"),
    ActorUtil: require("./src/ActorUtil"),
    ActorMessages: require("./src/ActorMessages.js"),
    ActorMatchers: require("./src/ActorMatchers.js")
}

},{"./src/ActorContext":2,"./src/ActorMatchers.js":3,"./src/ActorMessages.js":4,"./src/ActorRef":5,"./src/ActorSystem":6,"./src/ActorUtil":7}],2:[function(require,module,exports){
var ActorSystem = require("./ActorSystem");


var ActorContext = function (actor, reference, system, parent) {
    actor.context = this;
    actor.self = reference;
    reference.context = this;
    this.system = system;
    this.self = reference;
    this.parent = parent;
    this.children = { };

}

ActorContext.prototype.actorOf = function(clss, name, options) {
    var ActorUtil = require("./ActorUtil");
    var child = ActorUtil.newActor(clss, this.system, this.self, name, options);
    this.children[name] = child;
    return child;
}

ActorContext.prototype.actorFor = function(name) {
    if (name[0] === '/')
        return this.system.actorFor(name);

    if (name === '..')
        return this.parent;

    if (name.substring(0, 3) === '../')
        return this.parent.context.actorFor(name.substring(3));

    if (name.indexOf(':') > 0)
        return this.system.actorFor(name);

    var position = name.indexOf('/');

    if (position > 0) {
        var rest = name.substring(position + 1);
        name = name.substring(0, position);
        return this.children[name].context.actorFor(rest);
    }
    else
        return this.children[name];
}

module.exports = ActorContext;
},{"./ActorSystem":6,"./ActorUtil":7}],3:[function(require,module,exports){
var TypeMatcher = function(receive){

    return function(message){
        if(!receive[message.type]) throw new Error("Connot typeMatch: " + message.type);
        receive[message.type](message.data)
    }

};

module.exports = {
    TypeMatcher: TypeMatcher
};

},{}],4:[function(require,module,exports){
var TypeMessage = function (type, data) {
    return {
        type: type,
        data: data
    }
}


module.exports = {
    TypeMessage: TypeMessage
};

},{}],5:[function(require,module,exports){
function ActorRef(actor, parentpath, name) {
    this.actor = actor;
    this.path = parentpath + "/" + name;
    console.log("Path: ", this.path)
}

ActorRef.prototype.tell = function (msg) {
    this.actor.receive(msg);
}

module.exports = ActorRef;
},{}],6:[function(require,module,exports){
var ActorUtil = require("./ActorUtil");

function ActorSystem(name) {
    var counter = 0;
    this.name = name;
    this.path = "actor://" + name;
    this.children = { };

    this.nextName = function () {
        counter++;
        return '_' + counter;
    }
}

ActorSystem.prototype.actorOf = function(clss, name, options) {
    var actor = ActorUtil.newActor(clss, this, null, name, options);
    this.children[name] = actor;
    return actor;
}

ActorSystem.prototype.actorFor = function (name) {
    if (name.indexOf(':') > 0) {
        var path = ActorUtil.parsePath(name);

        if (path.server) {
            var servername = path.server + ':' + path.port;
            if (servername !== this.node.name)
                return this.node.getNode(servername).getSystem(path.system).actorFor(path.path);
        }

        name = path.path;
    }

    if (name && name[0] === '/')
        name = name.substring(1);

    var position = name.indexOf('/');

    if (position > 0) {
        var rest = name.substring(position + 1);
        name = name.substring(0, position);
        return this.children[name].context.actorFor(rest);
    }
    else
        return this.children[name];
}

module.exports = ActorSystem;

},{"./ActorUtil":7}],7:[function(require,module,exports){
var ActorUtil = {

    newActor: function (clss, system, parent, name) {
        var actor;

        if (typeof clss === 'function')
            actor = new clss();
        else
            actor = clss;

        if (!name)
            name = system.nextName();

        var ActorRef = require("./ActorRef");
        var ref = new ActorRef(actor, parent ? parent.path : system.path, name);

        var ActorContext = require("./ActorContext");
        var context = new ActorContext(actor, ref, system, parent);


        actor.context = context;

        actor.persist = function(msg){
            console.log("PERSIST")
            actor.update(msg)
        }

        return ref;
    },

    parsePath: function (path) {
        var result = {};
        var position = path.indexOf(':');

        result.protocol = path.substring(0, position);

        var rest = path.substring(position + 3);

        var positionat = rest.indexOf('@');
        position = rest.indexOf('/');

        if (positionat >= 0 && positionat < position) {
            result.system = rest.substring(0, positionat);
            result.server = rest.substring(positionat + 1, position);

            var poscolon = result.server.indexOf(':');

            if (poscolon > 0) {
                result.port = parseInt(result.server.substring(poscolon + 1));
                result.server = result.server.substring(0, poscolon);
            }
        }
        else
            result.system = rest.substring(0, position);

        result.path = rest.substring(position);

        return result;
    }
}

module.exports = ActorUtil;

},{"./ActorContext":2,"./ActorRef":5}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJEOlxcUHJvamVjdHNcXGFjdG9yanNcXGFjdG9yLWNvcmVcXGluZGV4LmpzIiwiRDpcXFByb2plY3RzXFxhY3RvcmpzXFxhY3Rvci1jb3JlXFxzcmNcXEFjdG9yQ29udGV4dC5qcyIsIkQ6XFxQcm9qZWN0c1xcYWN0b3Jqc1xcYWN0b3ItY29yZVxcc3JjXFxBY3Rvck1hdGNoZXJzLmpzIiwiRDpcXFByb2plY3RzXFxhY3RvcmpzXFxhY3Rvci1jb3JlXFxzcmNcXEFjdG9yTWVzc2FnZXMuanMiLCJEOlxcUHJvamVjdHNcXGFjdG9yanNcXGFjdG9yLWNvcmVcXHNyY1xcQWN0b3JSZWYuanMiLCJEOlxcUHJvamVjdHNcXGFjdG9yanNcXGFjdG9yLWNvcmVcXHNyY1xcQWN0b3JTeXN0ZW0uanMiLCJEOlxcUHJvamVjdHNcXGFjdG9yanNcXGFjdG9yLWNvcmVcXHNyY1xcQWN0b3JVdGlsLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsTUFBTSxDQUFDLE9BQU8sR0FBRztJQUNiLFFBQVEsRUFBRSxPQUFPLENBQUMsZ0JBQWdCLENBQUM7SUFDbkMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQztJQUMzQyxXQUFXLEVBQUUsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0lBQ3pDLFNBQVMsRUFBRSxPQUFPLENBQUMsaUJBQWlCLENBQUM7SUFDckMsYUFBYSxFQUFFLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQztJQUNoRCxhQUFhLEVBQUUsT0FBTyxDQUFDLHdCQUF3QixDQUFDOzs7O0FDTnBELElBQUksV0FBVyxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUMzQzs7QUFFQSxJQUFJLFlBQVksR0FBRyxVQUFVLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRTtJQUMzRCxLQUFLLENBQUMsT0FBTyxH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USxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUM5RCxNQUFNLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQzthQUN4RDtBQUNiLFNBQVM7O0FBRVQsWUFBWSxNQUFNLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDOztBQUV4RCxRQUFRLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQzs7UUFFdkMsT0FBTyxNQUFNLENBQUM7S0FDakI7QUFDTCxDQUFDOztBQUVELE1BQU0sQ0FBQyxPQUFPLEdBQUcsU0FBUyIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCJtb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIEFjdG9yUmVmOiByZXF1aXJlKFwiLi9zcmMvQWN0b3JSZWZcIiksXHJcbiAgICBBY3RvckNvbnRleHQ6IHJlcXVpcmUoXCIuL3NyYy9BY3RvckNvbnRleHRcIiksXHJcbiAgICBBY3RvclN5c3RlbTogcmVxdWlyZShcIi4vc3JjL0FjdG9yU3lzdGVtXCIpLFxyXG4gICAgQWN0b3JVdGlsOiByZXF1aXJlKFwiLi9zcmMvQWN0b3JVdGlsXCIpLFxyXG4gICAgQWN0b3JNZXNzYWdlczogcmVxdWlyZShcIi4vc3JjL0FjdG9yTWVzc2FnZXMuanNcIiksXHJcbiAgICBBY3Rvck1hdGNoZXJzOiByZXF1aXJlKFwiLi9zcmMvQWN0b3JNYXRjaGVycy5qc1wiKVxyXG59IiwidmFyIEFjdG9yU3lzdGVtID0gcmVxdWlyZShcIi4vQWN0b3JTeXN0ZW1cIik7XHJcblxyXG5cclxudmFyIEFjdG9yQ29udGV4dCA9IGZ1bmN0aW9uIChhY3RvciwgcmVmZXJlbmNlLCBzeXN0ZW0sIHBhcmVudCkge1xyXG4gICAgYWN0b3IuY29udGV4dCA9IHRoaXM7XHJcbiAgICBhY3Rvci5zZWxmID0gcmVmZXJlbmNlO1xyXG4gICAgcmVmZXJlbmNlLmNvbnRleHQgPSB0aGlzO1xyXG4gICAgdGhpcy5zeXN0ZW0gPSBzeXN0ZW07XHJcbiAgICB0aGlzLnNlbGYgPSByZWZlcmVuY2U7XHJcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcclxuICAgIHRoaXMuY2hpbGRyZW4gPSB7IH07XHJcblxyXG59XHJcblxyXG5BY3RvckNvbnRleHQucHJvdG90eXBlLmFjdG9yT2YgPSBmdW5jdGlvbihjbHNzLCBuYW1lLCBvcHRpb25zKSB7XHJcbiAgICB2YXIgQWN0b3JVdGlsID0gcmVxdWlyZShcIi4vQWN0b3JVdGlsXCIpO1xyXG4gICAgdmFyIGNoaWxkID0gQWN0b3JVdGlsLm5ld0FjdG9yKGNsc3MsIHRoaXMuc3lzdGVtLCB0aGlzLnNlbGYsIG5hbWUsIG9wdGlvbnMpO1xyXG4gICAgdGhpcy5jaGlsZHJlbltuYW1lXSA9IGNoaWxkO1xyXG4gICAgcmV0dXJuIGNoaWxkO1xyXG59XHJcblxyXG5BY3RvckNvbnRleHQucHJvdG90eXBlLmFjdG9yRm9yID0gZnVuY3Rpb24obmFtZSkge1xyXG4gICAgaWYgKG5hbWVbMF0gPT09ICcvJylcclxuICAgICAgICByZXR1cm4gdGhpcy5zeXN0ZW0uYWN0b3JGb3IobmFtZSk7XHJcblxyXG4gICAgaWYgKG5hbWUgPT09ICcuLicpXHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50O1xyXG5cclxuICAgIGlmIChuYW1lLnN1YnN0cmluZygwLCAzKSA9PT0gJy4uLycpXHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmNvbnRleHQuYWN0b3JGb3IobmFtZS5zdWJzdHJpbmcoMykpO1xyXG5cclxuICAgIGlmIChuYW1lLmluZGV4T2YoJzonKSA+IDApXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3lzdGVtLmFjdG9yRm9yKG5hbWUpO1xyXG5cclxuICAgIHZhciBwb3NpdGlvbiA9IG5hbWUuaW5kZXhPZignLycpO1xyXG5cclxuICAgIGlmIChwb3NpdGlvbiA+IDApIHtcclxuICAgICAgICB2YXIgcmVzdCA9IG5hbWUuc3Vic3RyaW5nKHBvc2l0aW9uICsgMSk7XHJcbiAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIHBvc2l0aW9uKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbltuYW1lXS5jb250ZXh0LmFjdG9yRm9yKHJlc3QpO1xyXG4gICAgfVxyXG4gICAgZWxzZVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuW25hbWVdO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEFjdG9yQ29udGV4dDtcclxuIiwidmFyIFR5cGVNYXRjaGVyID0gZnVuY3Rpb24ocmVjZWl2ZSl7XHJcblxyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKG1lc3NhZ2Upe1xyXG4gICAgICAgIGlmKCFyZWNlaXZlW21lc3NhZ2UudHlwZV0pIHRocm93IG5ldyBFcnJvcihcIkNvbm5vdCB0eXBlTWF0Y2g6IFwiICsgbWVzc2FnZS50eXBlKTtcclxuICAgICAgICByZWNlaXZlW21lc3NhZ2UudHlwZV0obWVzc2FnZS5kYXRhKVxyXG4gICAgfVxyXG5cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gICAgVHlwZU1hdGNoZXI6IFR5cGVNYXRjaGVyXHJcbn07IiwidmFyIFR5cGVNZXNzYWdlID0gZnVuY3Rpb24gKHR5cGUsIGRhdGEpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdHlwZTogdHlwZSxcclxuICAgICAgICBkYXRhOiBkYXRhXHJcbiAgICB9XHJcbn1cclxuXHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIFR5cGVNZXNzYWdlOiBUeXBlTWVzc2FnZVxyXG59OyIsImZ1bmN0aW9uIEFjdG9yUmVmKGFjdG9yLCBwYXJlbnRwYXRoLCBuYW1lKSB7XHJcbiAgICB0aGlzLmFjdG9yID0gYWN0b3I7XHJcbiAgICB0aGlzLnBhdGggPSBwYXJlbnRwYXRoICsgXCIvXCIgKyBuYW1lO1xyXG4gICAgY29uc29sZS5sb2coXCJQYXRoOiBcIiwgdGhpcy5wYXRoKVxyXG59XHJcblxyXG5BY3RvclJlZi5wcm90b3R5cGUudGVsbCA9IGZ1bmN0aW9uIChtc2cpIHtcclxuICAgIHRoaXMuYWN0b3IucmVjZWl2ZShtc2cpO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEFjdG9yUmVmO1xyXG4iLCJ2YXIgQWN0b3JVdGlsID0gcmVxdWlyZShcIi4vQWN0b3JVdGlsXCIpO1xyXG5cclxuZnVuY3Rpb24gQWN0b3JTeXN0ZW0obmFtZSkge1xyXG4gICAgdmFyIGNvdW50ZXIgPSAwO1xyXG4gICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgIHRoaXMucGF0aCA9IFwiYWN0b3I6Ly9cIiArIG5hbWU7XHJcbiAgICB0aGlzLmNoaWxkcmVuID0geyB9O1xyXG5cclxuICAgIHRoaXMubmV4dE5hbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY291bnRlcisrO1xyXG4gICAgICAgIHJldHVybiAnXycgKyBjb3VudGVyO1xyXG4gICAgfVxyXG59XHJcblxyXG5BY3RvclN5c3RlbS5wcm90b3R5cGUuYWN0b3JPZiA9IGZ1bmN0aW9uKGNsc3MsIG5hbWUsIG9wdGlvbnMpIHtcclxuICAgIHZhciBhY3RvciA9IEFjdG9yVXRpbC5uZXdBY3RvcihjbHNzLCB0aGlzLCBudWxsLCBuYW1lLCBvcHRpb25zKTtcclxuICAgIHRoaXMuY2hpbGRyZW5bbmFtZV0gPSBhY3RvcjtcclxuICAgIHJldHVybiBhY3RvcjtcclxufVxyXG5cclxuQWN0b3JTeXN0ZW0ucHJvdG90eXBlLmFjdG9yRm9yID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgIGlmIChuYW1lLmluZGV4T2YoJzonKSA+IDApIHtcclxuICAgICAgICB2YXIgcGF0aCA9IEFjdG9yVXRpbC5wYXJzZVBhdGgobmFtZSk7XHJcblxyXG4gICAgICAgIGlmIChwYXRoLnNlcnZlcikge1xyXG4gICAgICAgICAgICB2YXIgc2VydmVybmFtZSA9IHBhdGguc2VydmVyICsgJzonICsgcGF0aC5wb3J0O1xyXG4gICAgICAgICAgICBpZiAoc2VydmVybmFtZSAhPT0gdGhpcy5ub2RlLm5hbWUpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ub2RlLmdldE5vZGUoc2VydmVybmFtZSkuZ2V0U3lzdGVtKHBhdGguc3lzdGVtKS5hY3RvckZvcihwYXRoLnBhdGgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbmFtZSA9IHBhdGgucGF0aDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAobmFtZSAmJiBuYW1lWzBdID09PSAnLycpXHJcbiAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDEpO1xyXG5cclxuICAgIHZhciBwb3NpdGlvbiA9IG5hbWUuaW5kZXhPZignLycpO1xyXG5cclxuICAgIGlmIChwb3NpdGlvbiA+IDApIHtcclxuICAgICAgICB2YXIgcmVzdCA9IG5hbWUuc3Vic3RyaW5nKHBvc2l0aW9uICsgMSk7XHJcbiAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIHBvc2l0aW9uKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbltuYW1lXS5jb250ZXh0LmFjdG9yRm9yKHJlc3QpO1xyXG4gICAgfVxyXG4gICAgZWxzZVxyXG4gICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuW25hbWVdO1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEFjdG9yU3lzdGVtOyIsInZhciBBY3RvclV0aWwgPSB7XHJcblxyXG4gICAgbmV3QWN0b3I6IGZ1bmN0aW9uIChjbHNzLCBzeXN0ZW0sIHBhcmVudCwgbmFtZSkge1xyXG4gICAgICAgIHZhciBhY3RvcjtcclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBjbHNzID09PSAnZnVuY3Rpb24nKVxyXG4gICAgICAgICAgICBhY3RvciA9IG5ldyBjbHNzKCk7XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICBhY3RvciA9IGNsc3M7XHJcblxyXG4gICAgICAgIGlmICghbmFtZSlcclxuICAgICAgICAgICAgbmFtZSA9IHN5c3RlbS5uZXh0TmFtZSgpO1xyXG5cclxuICAgICAgICB2YXIgQWN0b3JSZWYgPSByZXF1aXJlKFwiLi9BY3RvclJlZlwiKTtcclxuICAgICAgICB2YXIgcmVmID0gbmV3IEFjdG9yUmVmKGFjdG9yLCBwYXJlbnQgPyBwYXJlbnQucGF0aCA6IHN5c3RlbS5wYXRoLCBuYW1lKTtcclxuXHJcbiAgICAgICAgdmFyIEFjdG9yQ29udGV4dCA9IHJlcXVpcmUoXCIuL0FjdG9yQ29udGV4dFwiKTtcclxuICAgICAgICB2YXIgY29udGV4dCA9IG5ldyBBY3RvckNvbnRleHQoYWN0b3IsIHJlZiwgc3lzdGVtLCBwYXJlbnQpO1xyXG5cclxuXHJcbiAgICAgICAgYWN0b3IuY29udGV4dCA9IGNvbnRleHQ7XHJcblxyXG4gICAgICAgIGFjdG9yLnBlcnNpc3QgPSBmdW5jdGlvbihtc2cpe1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlBFUlNJU1RcIilcclxuICAgICAgICAgICAgYWN0b3IudXBkYXRlKG1zZylcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiByZWY7XHJcbiAgICB9LFxyXG5cclxuICAgIHBhcnNlUGF0aDogZnVuY3Rpb24gKHBhdGgpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICAgICAgdmFyIHBvc2l0aW9uID0gcGF0aC5pbmRleE9mKCc6Jyk7XHJcblxyXG4gICAgICAgIHJlc3VsdC5wcm90b2NvbCA9IHBhdGguc3Vic3RyaW5nKDAsIHBvc2l0aW9uKTtcclxuXHJcbiAgICAgICAgdmFyIHJlc3QgPSBwYXRoLnN1YnN0cmluZyhwb3NpdGlvbiArIDMpO1xyXG5cclxuICAgICAgICB2YXIgcG9zaXRpb25hdCA9IHJlc3QuaW5kZXhPZignQCcpO1xyXG4gICAgICAgIHBvc2l0aW9uID0gcmVzdC5pbmRleE9mKCcvJyk7XHJcblxyXG4gICAgICAgIGlmIChwb3NpdGlvbmF0ID49IDAgJiYgcG9zaXRpb25hdCA8IHBvc2l0aW9uKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5zeXN0ZW0gPSByZXN0LnN1YnN0cmluZygwLCBwb3NpdGlvbmF0KTtcclxuICAgICAgICAgICAgcmVzdWx0LnNlcnZlciA9IHJlc3Quc3Vic3RyaW5nKHBvc2l0aW9uYXQgKyAxLCBwb3NpdGlvbik7XHJcblxyXG4gICAgICAgICAgICB2YXIgcG9zY29sb24gPSByZXN1bHQuc2VydmVyLmluZGV4T2YoJzonKTtcclxuXHJcbiAgICAgICAgICAgIGlmIChwb3Njb2xvbiA+IDApIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5wb3J0ID0gcGFyc2VJbnQocmVzdWx0LnNlcnZlci5zdWJzdHJpbmcocG9zY29sb24gKyAxKSk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuc2VydmVyID0gcmVzdWx0LnNlcnZlci5zdWJzdHJpbmcoMCwgcG9zY29sb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICAgICAgcmVzdWx0LnN5c3RlbSA9IHJlc3Quc3Vic3RyaW5nKDAsIHBvc2l0aW9uKTtcclxuXHJcbiAgICAgICAgcmVzdWx0LnBhdGggPSByZXN0LnN1YnN0cmluZyhwb3NpdGlvbik7XHJcblxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQWN0b3JVdGlsOyJdfQ==
